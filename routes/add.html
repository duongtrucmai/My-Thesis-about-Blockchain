<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="UTF-8">
  <title>Tạo thông tin </title>
  <link rel="stylesheet" href="css/styleadd.css">
  <link href="image/logo.PNG" rel="shortcut icon" type="image/vnd.microsoft.icon" /> 
 
  <meta name="viewport" content=""width=device-width, initial-scale="1.0">
  
</head>

   
    
 
  <br><br>
<body><br><br>
    <div class="container">
        <h1 class="form-title">Hãy thêm các thông tin sau</h1>
        <form action="#">
            <div class="main-user-info">
                <div class="user-input-box">
                <label for="name">Họ và Tên</label>
                <input type="text" id="fullname" placeholder="Ghi rõ Họ và Tên" name="fullname" required style = "font-family: 'Verdana, Geneva, Tahoma, sans-serif';">
            </div>

                <div class="user-input-box">
                <label for="name">Mã số sinh viên</label>
                <input type="text" id="mssv" placeholder="Nhập MSSV" name="mssv" required style = "font-family: 'Verdana, Geneva, Tahoma, sans-serif';">
            </div>

                <div class="user-input-box">
                <label for="name">Tên Trường</label>
                <input type="text" id="truong" placeholder="Nhập tên Trường Đại học" name="truong" required style = "font-family: 'Verdana, Geneva, Tahoma, sans-serif';">
            </div>

                <div class="user-input-box">
                <label for="name">Loại Bằng Tốt nghiệp</label>
                <select id="bang" name="bang" style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'; width: 95%; height: 40px; padding: 0 10px; border: 1px solid #333; border-radius: 7px;">
                    <option value=""  style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'">Chọn loại bằng</option>
                    <option value="cu_nhan"  style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'">Cử nhân</option>
                    <option value="ky_su"  style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'">Kỹ sư</option>
                    <option value="bac_si"  style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'">Bác sĩ</option>
                    <option value="thac_si"  style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'">Thạc sĩ</option>
                 </select>
            </div>

                <div class="user-input-box">
                <label for="name">Ngày sinh</label>
                <input type="date" id="ngaysinh" placeholder="mm/dd/yyyy" name="ngaysinh" required style = "font-family: 'Verdana, Geneva, Tahoma, sans-serif';">
            </div>

                <div class="user-input-box">
                <label for="name">Ngành học</label>
                <input type="text" id="nganh" placeholder="Nhập ngành học" name="nganh" required style = "font-family: 'Verdana, Geneva, Tahoma, sans-serif';">
            </div>

                <div class="user-input-box">
                <label for="name">Năm tốt nghiệp</label>
                <input type="text" id="nam" placeholder="Nhập Năm Tốt nghiệp" name="nam" required style = "font-family: 'Verdana, Geneva, Tahoma, sans-serif';">
            </div>

                <div class="user-input-box">
                <label for="name">Xếp loại tốt nghiệp</label>
                <select id="loai" name="loai" style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'; width: 95%; height: 40px; padding: 0 10px; border: 1px solid #333; border-radius: 7px;">
                    <option value=""  style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'">Chọn xếp loại tốt nghiệp</option>
                    <option value="kha"  style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'">Khá</option>
                    <option value="gioi"  style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'">Giỏi</option>
                    <option value="xuatsac"  style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'">Xuất sắc</option>
                 </select>
            </div>

                <div class="user-input-box">
                <label for="name">Hình thức tốt nghiệp</label>
                <select id="hinhthuc" name="hinhthuc" style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'; width: 95%; height: 40px; padding: 0 10px; border: 1px solid #333; border-radius: 7px;">
                    <option value=""  style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'">Chọn hình thức tốt nghiệp</option>
                    <option value="chinhquy"  style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'">Chính quy</option>
                    <option value="saudaihoc"  style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'">Sau đại học</option>
                    <option value="vuahocvualam"  style="font-family: 'Verdana, Geneva, Tahoma, sans-serif'">Vừa học vừa làm</option>
                 </select>
            </div>

                <div class="user-input-box">
                <label for="name">Số hiệu</label>
                <input type="text" id="sohieu" placeholder="ví dụ: VBXXXX" name="sohieu" required style = "font-family: 'Verdana, Geneva, Tahoma, sans-serif';">
            </div>

            <div class ="form-submit-btn">
                <input type="submit" value="Tạo thông tin">
            </div>

            

        </div>   
        <a href = "index.html" >Quay về Trang chủ</a> 
        </form>
   
    </div>
   
    
    

    
       


   

</body><br><br><br><br>

</html>

<script>
    const express = require('express');
const app = express();
const router = express.Router();
const { accountData } = require('../data.js');

router.get('/add', (req, res, next) => {
  res.render('add.ejs');
});

router.post('/add', async (req, res, next) => {
  const { 
    truong, 
    mssv, 
    bang, 
    fullname,
    ngaysinh,
    nganh,
    nam,
    loai,
    hinhthuc,
    sohieu,
  } = req.body;

  try {
    // Check for duplicate mssv and truong:
    const existingAccount = await accountData.findOne({ fullname, mssv, truong });
    if (existingAccount) {
      return res.status(400).json({ message: 'Thông tin đã có, vui lòng kiểm tra lại' });
    }

    const createdAccount = await accountData.create({
      truong,
      mssv,
      bang,
      fullname,
      ngaysinh,
      nganh,
      nam,
      loai,
      hinhthuc,
      sohieu,
    });

    res.render('dashboard.ejs');
  } catch (err) {
    console.error(err); // Log the error for debugging
    res.status(500).json({ message: 'Tạo tài khoản thất bại' });
  }
});

module.exports = router;
</script>


